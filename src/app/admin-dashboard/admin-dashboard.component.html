<!-- <app-background></app-background> -->

<div class="p-0 m-0">
  <div class="row g-0">

    <!-- Sidebar -->
    <div class="col-1">
      <app-admin-navbar></app-admin-navbar>
    </div>

    <!-- Main Content -->
    <div class="col-11 main min-vh-100">

      <!-- Top Bar -->
      <div class="top-bar">
        <!-- Account -->
        <a class="account-link" [routerLink]="['/admin-profile']">
          <div class="account">
            <div class="account-img">
              <img [src]="profileImage || 'images/admin.png'" (error)="onImageError($event)"
                class="dropdown-toggle rounded-circle user-avatar" style="width:50px; height:50px; cursor:pointer;"
                role="button" tabindex="0" (click)="toggleMenu($event)" (keydown.enter)="toggleMenu($event)"
                [attr.aria-expanded]="menuOpen" alt="Utilisateur" /> 
            </div>
            <h4>{{userName}}</h4>
          </div>
        </a>
      </div>

      <!-- Page Content -->
      <div class="content d-flex flex-column justify-content-center align-items-center">
        <div class="section1 col-6">
          <div class="row justify-content-between g-4 align-items-stretch">

            <!-- Total Requests -->
            <div class="col-12 col-md-6 col-lg-4 d-flex flex-column gap-3">
              <div class="part">
                <h5>Total des commandes</h5>
                <h1>{{totalCarts}}</h1>
                <p *ngIf="trend">
                  <i class="bi" [ngClass]="{
      'bi-arrow-up-circle text-success': trend.trend === 'up',
      'bi-arrow-down-circle text-danger': trend.trend === 'down',
      'bi-dash-circle text-secondary': trend.trend === 'equal'
    }"></i>
                  {{ trend.percentage.toFixed(2) }}% par rapport à hier
                </p>
              </div>

              <!-- New Clients -->
              <div class="part clients-part d-flex flex-column gap-2">
                <h5>Nouveaux clients ce mois</h5>
                <h1>{{newProfiles.length}}</h1>
                <p *ngIf="userStats">
                  <i class="bi" [ngClass]="{
      'bi-arrow-up-circle text-success': userStats.trend === 'up',
      'bi-arrow-down-circle text-danger': userStats.trend === 'down',
      'bi-dash-circle text-secondary': userStats.trend === 'equal'
    }"></i>
                  {{ userStats.percentage.toFixed(2) }}% d’utilisateurs en plus ce mois
                </p>
              </div>
            </div>

            <!-- Total Sales & Best Products -->
            <div class="col-12 col-md-6 col-lg-4 d-flex flex-column gap-3">
              <div class="part">
                <h5>Total des ventes</h5>
                <h1>{{deliveredCarts}}</h1>
                <p *ngIf="deliveredStats">
                  <i class="bi" [ngClass]="{
      'bi-arrow-up-circle text-success': deliveredStats.trend === 'up',
      'bi-arrow-down-circle text-danger': deliveredStats.trend === 'down',
      'bi-dash-circle text-secondary': deliveredStats.trend === 'equal'
    }"></i>
                  {{ deliveredStats.percentage.toFixed(2) }}% de commandes livrées aujourd’hui
                </p>
              </div>

              <div class="part">
                <h5>Produits les plus vendus</h5>
                <div class="best-products">
                  <div *ngFor="let item of top3CartItems">
                    <div class="product"> {{ item.name }} ({{ item.count }})</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Low Stock -->
            <div class="col-12 col-md-6 col-lg-3 part side-bar d-flex justify-content-start align-items-center">
              <h5 class="mb-3">Presque épuisé</h5>
              <div *ngFor="let product of lowStockProducts">
                <app-admin-product-card [img]="product.images[0]" [title]="product.title" [price]="product.final_price"
                  [isAlmostFinished]="true"></app-admin-product-card>
              </div>
            </div>

          </div>
        </div>

        <!-- Section 2 -->
        <div class="section2 col-6">
          <div class="row justify-content-between g-4 align-items-stretch">
            
            <!-- Chart -->
            <div class="col-12 col-md-6 col-lg-8 d-flex flex-column gap-3">
              <div class="part chart"><app-chart></app-chart></div>
            </div>

            <!-- Out of Stock -->
            <div class="col-12 col-md-12 col-lg-3 part side-bar d-flex flex-column justify-content-start align-items-center">
              <h5 class="mb-3">En attente de réapprovisionnement</h5>
              <div *ngFor="let product of outOfStockProducts">
                <app-admin-product-card [img]="product.images[0]" [title]="product.title" [price]="product.final_price"
                  [isAlmostFinished]="false"></app-admin-product-card>
              </div>
            </div>

          </div>
        </div>

      </div>

    </div>
  </div>
</div>
