<app-game-template 
  [showHeader]="false" 
  [showTopIcons]="false" 
  [noCardBackground]="true">  
  <div class="canvas-app">
    
    <!-- Header Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <div class="logo">
          <img src="/images/logo-patarif.png" alt="Patarif">
          <span class="app-title">Digital Canvas</span>
        </div>
      </div>
      
      <div class="toolbar-center">
        <div class="action-buttons">
          <button class="action-btn" 
                  (click)="undo()" 
                  [disabled]="historyIndex <= 0"
                  title="Undo (Ctrl+Z)">
            <i class="fas fa-undo"></i>
          </button>
          <button class="action-btn" 
                  (click)="redo()" 
                  [disabled]="historyIndex >= drawingHistory.length - 1"
                  title="Redo (Ctrl+Y)">
            <i class="fas fa-redo"></i>
          </button>
          <div class="divider"></div>
          <button class="action-btn danger" 
                  (click)="clearCanvas()"
                  title="Clear Canvas">
            <i class="fas fa-trash-alt"></i>
          </button>
          <button class="action-btn primary" 
                  (click)="downloadImage()"
                  title="Download (Ctrl+S)">
            <i class="fas fa-download"></i>
          </button>
          <button class="action-btn" 
                  (click)="toggleFullscreen()"
                  title="Fullscreen">
            <i class="fas fa-expand"></i>
          </button>
        </div>
      </div>
      
      <div class="toolbar-right">
        <button class="back-btn" (click)="goBack()">
          <i class="fas fa-arrow-left"></i>
          Back to Gallery
        </button>
      </div>
    </div>

    <!-- Main Canvas Area -->
    <div class="canvas-container">
      <!-- Left Tool Panel -->
      <div class="tool-panel">
        <!-- Tool Selection -->
        <div class="tool-section">
          <h3 class="section-title">Tools</h3>
          <div class="tool-grid">
            <button class="tool-btn" 
                    [class.active]="currentTool === 'pen'"
                    (click)="selectTool('pen')"
                    title="Pen (P)">
              <i class="fas fa-pen"></i>
              <span>Pen</span>
            </button>
            <button class="tool-btn" 
                    [class.active]="currentTool === 'brush'"
                    (click)="selectTool('brush')"
                    title="Brush (B)">
              <i class="fas fa-paint-brush"></i>
              <span>Brush</span>
            </button>
            <button class="tool-btn" 
                    [class.active]="currentTool === 'marker'"
                    (click)="selectTool('marker')"
                    title="Marker (M)">
              <i class="fas fa-highlighter"></i>
              <span>Marker</span>
            </button>
            <button class="tool-btn" 
                    [class.active]="currentTool === 'spray'"
                    (click)="selectTool('spray')"
                    title="Spray (S)">
              <i class="fas fa-spray-can"></i>
              <span>Spray</span>
            </button>
            <button class="tool-btn" 
                    [class.active]="currentTool === 'eraser'"
                    (click)="selectTool('eraser')"
                    title="Eraser (E)">
              <i class="fas fa-eraser"></i>
              <span>Eraser</span>
            </button>
          </div>
        </div>

        <!-- Color Selection -->
        <div class="tool-section">
          <h3 class="section-title">Colors</h3>
          <div class="color-picker-container">
            <input type="color" 
                   [(ngModel)]="selectedColor"
                   (change)="setColor(selectedColor)"
                   class="color-picker"
                   [disabled]="currentTool === 'eraser'">
            <div class="current-color" 
                 [style.background]="selectedColor"
                 [class.disabled]="currentTool === 'eraser'">
            </div>
          </div>
          
          <!-- Color Categories -->
          <div class="color-categories">
            <div *ngFor="let category of colorCategories | keyvalue" class="color-category">
              <div class="color-swatches">
                <div *ngFor="let color of category.value" 
                     class="color-swatch"
                     [style.background]="color"
                     [class.active]="selectedColor === color && currentTool !== 'eraser'"
                     (click)="selectPresetColor(color)">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Brush Settings -->
        <div class="tool-section">
          <h3 class="section-title">Brush</h3>
          
          <!-- Brush Size -->
          <div class="control-group">
            <label class="control-label">Size: {{ brushSize }}px</label>
            <input type="range" 
                   min="1" 
                   max="50" 
                   [(ngModel)]="brushSize"
                   (input)="setBrushSize(brushSize)"
                   class="slider">
          </div>

          <!-- Opacity -->
          <div class="control-group">
            <label class="control-label">Opacity: {{ Math.round(opacity * 100) }}%</label>
            <input type="range" 
                   min="0.1" 
                   max="1" 
                   step="0.1"
                   [(ngModel)]="opacity"
                   (input)="setOpacity(opacity)"
                   class="slider">
          </div>

          <!-- Brush Shape -->
          <div class="control-group">
            <label class="control-label">Shape</label>
            <div class="shape-options">
              <button class="shape-btn" 
                      [class.active]="brushShape === 'round'"
                      (click)="setBrushShape('round')"
                      title="Round">
                <i class="fas fa-circle"></i>
              </button>
              <button class="shape-btn" 
                      [class.active]="brushShape === 'square'"
                      (click)="setBrushShape('square')"
                      title="Square">
                <i class="fas fa-square"></i>
              </button>
              <button class="shape-btn" 
                      [class.active]="brushShape === 'calligraphy'"
                      (click)="setBrushShape('calligraphy')"
                      title="Calligraphy">
                <i class="fas fa-pen-fancy"></i>
              </button>
            </div>
          </div>

          <!-- Brush Presets -->
          <div class="control-group">
            <label class="control-label">Presets</label>
            <div class="preset-buttons">
              <button *ngFor="let preset of brushPresets" 
                      class="preset-btn"
                      (click)="selectBrushPreset(preset)">
                {{ preset.name }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Canvas Area -->
      <div class="canvas-area">
        <div class="canvas-wrapper">
          <canvas #drawingCanvas
                  class="drawing-canvas"
                  (mousedown)="startDrawing($event)"
                  (mousemove)="onMouseMove($event)"
                  (mouseup)="stopDrawing()"
                  (mouseleave)="onMouseLeave()"
                  (touchstart)="startDrawing($event)"
                  (touchmove)="onTouchMove($event)"
                  (touchend)="stopDrawing()"
                  (contextmenu)="$event.preventDefault()">
          </canvas>
          <div #cursorElement class="cursor" [class.pen]="currentTool !== 'eraser'" [class.eraser]="currentTool === 'eraser'"></div>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-left">
        <span class="status-item">Tool: {{ currentTool | titlecase }}</span>
        <span class="status-item">Size: {{ brushSize }}px</span>
        <span class="status-item">Opacity: {{ Math.round(opacity * 100) }}%</span>
      </div>
      <div class="status-right">
        <span class="status-item">Canvas: {{ canvasRef?.nativeElement?.width || 0 }}x{{ canvasRef?.nativeElement?.height || 0 }}</span>
      </div>
    </div>
  </div>
</app-game-template>