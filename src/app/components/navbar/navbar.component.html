<nav class="navbar navbar-expand-lg custom-navbar px-3 py-2">
  <div class="container-fluid">
    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center" href="">
      <img src="images/logo-patarif.png" alt="Logo" class="logo-img" />
    </a>

<div id="sideMenu" class="side-menu">
  <button class="close-btn" (click)="closeSideMenu()"><i class="bi bi-x-lg"></i></button>
  <ul>
    <a href="/profile" (click)="closeSideMenu()">
      <li class="d-flex align-items-center account">
        <img *ngIf="isLogged" [src]="profileImage || 'images/account.png'" (error)="onImageError($event)"
          class="dropdown-toggle rounded-circle user-avatar-side" style="width:50px; height:50px; cursor:pointer;"
          role="button" tabindex="0" (click)="toggleMenu($event)" (keydown.enter)="toggleMenu($event)"
          [attr.aria-expanded]="menuOpen" alt="User" /> <span class="user-name">{{userName}}</span>
      </li>
    </a>

    <li class="login" *ngIf="!isLogged"><a routerLink="/login" (click)="closeSideMenu()">Connexion</a></li>
    <li><a routerLink="/home" (click)="closeSideMenu()">Accueil</a></li>
    <li><a routerLink="/learning" (click)="closeSideMenu()">Zone d’apprentissage</a></li>
    <li><a routerLink="/games" (click)="closeSideMenu()">Aire de jeux</a></li>
    <li><a routerLink="/shop" (click)="closeSideMenu()">Boutique</a></li>
    <li><a routerLink="/contact-us" (click)="closeSideMenu()">Contact</a></li>
    <li class="logout" *ngIf="isLogged"><a routerLink="/login" (click)="onLogout()">Déconnexion</a></li>
  </ul>
</div>

    <!-- Navigation Links -->
    <div class="collapse navbar-collapse justify-content-center" id="mainNavbar">
      <ul class="navbar-nav gap-4">
        <li class="nav-item" routerLinkActive="active">
          <a class="nav-link nav-link-animated" routerLink="/home" routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }">Accueil</a>
        </li>
        <li class="nav-item" routerLinkActive="active">
          <a class="nav-link nav-link-animated" routerLink="/learning" routerLinkActive="active">Zone d’apprentissage</a>
        </li>
        <li class="nav-item" routerLinkActive="active">
          <a class="nav-link nav-link-animated" routerLink="/games" routerLinkActive="active">Aire de jeux</a>
        </li>
        <li class="nav-item" routerLinkActive="active">
          <a class="nav-link nav-link-animated" routerLink="/shop" routerLinkActive="active">Boutique</a>
        </li>
        <li class="nav-item" routerLinkActive="active">
          <a class="nav-link nav-link-animated" routerLink="/contact-us" routerLinkActive="active">Contact</a>
        </li>
      </ul>
    </div>

    <!-- Right Side (Search + Avatar) -->
    <div class="d-flex align-items-center gap-3 user-menu">
      <i *ngIf="isLogged" (click)="openSearch()" class="bi bi-search fs-5 search-icon"></i>

      <div class="dropdown" [class.show]="menuOpen">
        <img *ngIf="isLogged" [src]="profileImage || 'images/account.png'" (error)="onImageError($event)"
          class="dropdown-toggle rounded-circle user-avatar" style="width:50px; height:50px; cursor:pointer;"
          role="button" tabindex="0" (click)="toggleMenu($event)" (keydown.enter)="toggleMenu($event)"
          [attr.aria-expanded]="menuOpen" alt="User" />

        <button *ngIf="!isLogged" class="btn btn-primary login" [routerLink]="['/login']">
          <i class="bi bi-box-arrow-in-right"></i> Connexion
        </button>

        <ul class="dropdown-menu dropdown-menu-end shadow-sm" [class.show]="menuOpen">
          <ng-container *ngIf="isLogged; else guestMenu">
            <li>
              <a class="dropdown-item d-flex align-items-center gap-2" [routerLink]="['/profile']">
                <i class="bi bi-person-circle fs-5"></i> Profil
              </a>
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>
           <li>
              <a class="dropdown-item logout d-flex align-items-center gap-2 text-danger" (click)="onLogout()">
                <i class="bi bi-box-arrow-right fs-5"></i> Déconnexion
              </a>
            </li>
          </ng-container>

          <ng-template #guestMenu>
            <li>
              <a class="dropdown-item d-flex align-items-center gap-2" [routerLink]="['/login']">
                <i class="bi bi-box-arrow-in-right"></i> Connexion
              </a>
            </li>
          </ng-template>
        </ul>
      </div>

      <button class="menu-btn d-lg-none" (click)="openSideMenu()">
        <i class="bi bi-list"></i>
      </button>
    </div>

  </div>
</nav>

<app-search-modal [visible]="isOpen" (close)="isOpen = false"></app-search-modal>
